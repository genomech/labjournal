# Обработка экзомных данных

## Протокол

### 1. Оценка качества входных данных (*FastQC*)

```bash
fastqc -o $output_dir -t $core_number $input_dir/*.fastq.gz
```

* Размер последовательностей: >=8 букв
* Сверхрепрезентированные последовательности: отсутствуют

### 1a. Обрезка адаптеров (*cutadapt*)

### 2. Выравнивание и сортировка (*bowtie2*, *bwa*)

* Убрать неканонические хромосомы из bed-файла

### 3-4. Анализ качества выравниваний и удаление дубликатов (*BamQC*, *PicardTools*)

1. *PicardTools*: маркирование дубликатов.
2. *BamQC*: анализ с учётом предыдущего маркирования

Подготовка capture для QualiMap:

```bash
awk 'BEGIN{OFS="\t"}{print $1,$2,$3,$4,0,"."}' $capture.bed > "$capture"_QualiMap.bed
```

	* Доля выравненных последовательностей: >80%
	* Доля дупликатов в экзонах: <30%
3. Свой скрипт: выяснить, каким образом *PicardTools* маркирует дубликаты, и пометить дубликаты с разным strand. Рандомно оставлять + и - strand.
4. *PicardTools*: удаление дубликатов.

### 5. Оценка качества после удаления дупликатов

* Обогащение (среднее покрытие capture / среднее покрытие вне capture): >10
* Покрытие 95%: >=10
* Среднее покрытие (арифметическое): >= 70

Это сильно завышенные показатели, но к ним надо стремиться.

### 6. Идентификация вариантов (*GATK*, *freebayes*).

* Left realignment: *freebayes* делает это по умолчанию, но авторы протокола советуют делать это перед *freebayes*. 

**TODO:** Уточнить почему.

* Skip-limit (skip regions of extremely high coverage): стартовое значение 200 (уточнить по ходу работы).
* Миниальная доля альтернативных аллелей для гетерозигот: 0.25
* QUAL: начать с 18, подстраивать под контрольные метрики из предыдущих пунктов (конкретно: глубину покрытия в экзоме).

**TODO:** freebayes выдает значения QUAL, которые означают "надежность" найденного варианта. В файл пишутся все варианты, но их нужно фильтровать. Можно стартовать с QUAL >20, но надо уточню, какие значения используют другие.

* DP для идеальных данных (см. контроль качества выше): >12-15.
* DP при среднем покрытим <70: >8-10.
* DP при анализе конкретного гена: не учитывать.

### 7. Разбиение многобуквенных замен на однобуквенные (*vcfallelicprimitives*)

**TODO:** Узнать, что происходит с параметрами vcf при разбиении.

### 8. Аннотация вариантов (*Annovar*, *Ensembl VEP*)

**TODO:** Стоит ли нам мигрировать на *Annovar*?

1. Нужно отмечать главную (каноническую) изоформу. В *Ensembl VEP* есть опция, нужно поискать, в *Annovar* это по дефолту. 
2. В *Ensembl VEP* полезно включать low complexity filter. Нужно найти его и проверить, включен ли он у нас.
3. *Annovar* пишет в файл все варианты, уже потом их фильтрует по значимости.

### 9. Поиск по таблице

* Отбор по частоте в популяционных данных (берём максимальную из всех БД, но в процессе анализа смотрим данные по всем).
	* Если частое аутосомно-рецессивное заболевание: частота по БД <5%.
	* Если редкое: <0.05-0.5%. 
	* Нижняя граница частоты: 0.01%. При анализе всегда берётся чуть выше.

**TODO:** Нужно проверить, почему в наших таблицах не всегда совпадают частоты с указанными в БД, если это глюк *Ensembl VEP*, перейти на *Annovar*. Пример: PRODH (HGMD) - нет частоты. В других БД частота высокая, в 1000 геномов, например.

* Поиск вариантов
	* Поиск loss-of-function variants: frameshift, stop codon, splice-site.
	* Если ничего не нашлось, ищем missence.

### 10. Проверка найденного

* Проверка сырых данных в bam-файле (не последний ли/первый/альтернативный экзон).
* Перепроверка частот в популяции по разным БД.
* GnomAD/ExAC loss-of-function intolerant (pLI) score для гена. Сверять с мышиными фенотипами, литературой и проч.
* HGMD. Описана ли в этой позиции другая замена и какой её эффект.
* ClinVar. Ей доверия меньше, поэтому после остальных.
* OMIM. Сравнение известного фенотипа с фенотипом по БД.
* SIFT, PolyPhen и пр.: предсказание эффекта.

### 11. Прочие особенности анализа

* Если есть подозрение на ограниченный список генов, сначала анализируются варианты в этих генах.
* Если нет: полный анализ.

## Требуемая информация по мутации

* Референсный аллель
* Замена
* Плоидность
* QUAL (*freebayes*)
* Имя гена
* Импакт
* Максимальная частота встречаемости из всех БД, частоты по разным БД

**Примечание.** Отдельным пунктом надо отмечать присутствие мутации в разных БД и разброс по частотам.

* pLI-score
* OMIM
* HGMD
* ClinVar
* Номер экзона, общее число экзонов
* DP: суммарное + для каждого из вариантов, если гетерозигота
* Координата (сортировка)
* Все остальные данные, в т.ч. данные программ, предсказывающих эффекты сплайсинга, замен АК, etc.

## Ссылки

1. [Калькулятор патогенности вариантов нуклеотидной последовательности](http://calc.generesearch.ru/)
